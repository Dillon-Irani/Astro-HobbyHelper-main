---
import Layout from '../layouts/Layout.astro';
import { XataClient } from '.././xata';

const xata = new XataClient({
  apiKey: import.meta.env.XATA_API_KEY,
  branch: import.meta.env.XATA_BRANCH
});

const messages = [];
let messageSent = false; // Add a variable to track whether the message has been sent

if (Astro.request.method === "POST") {
  try {
    const data = await Astro.request.formData();
    const action = data.get('action'); // Get the value of the 'action' field

    // Check if the action is 'contactFormSubmit'
    if (action === 'requestFormSubmit') {
      const inputMessage = String(data.get("message"));
      const currentDate = new Date().getDate();

      const newUser = await xata.db.requests.create({
        request_description: inputMessage,
        date_requested: currentDate,
      });

      console.log("request form submission:", messages);
      messageSent = true;
    }

  } catch (error) {
    if (error instanceof Error) {
      console.error(error.message);
    }
  }
}
// Get the current hour
const currentHour = new Date().getHours();

// Determine the background image based on the time of day
const backgroundImage = currentHour >= 6 && currentHour < 18
  ? "../images/background4.gif" // Daytime background
  : "../images/background3.gif"; // Nighttime background
---

<style define:vars={{ backgroundImage }}>
body  {
    background-image: url('https://i.imgur.com/iEQcz0Z.jpeg');
  background-size:cover;
        -webkit-animation: slidein 100s;
        animation: slidein 100s;

        -webkit-animation-fill-mode: forwards;
        animation-fill-mode: forwards;

        -webkit-animation-iteration-count: infinite;
        animation-iteration-count: infinite;

        -webkit-animation-direction: alternate;
        animation-direction: alternate;              
}

@-webkit-keyframes slidein {
from {background-position: top; background-size:2500px; }
to {background-position: -50px 0px;background-size:2750px;}
}

@keyframes slidein {
from {background-position: top;background-size:2000px; }
to {background-position: -50px 0px;background-size:2750px;}

}


  .container {
    max-width: 400px;
    margin: 50px auto;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    width: 100%;
    display: flex;
    overflow: auto;
    align-items: center;
    flex-direction: column;
    justify-content: center;
    background-color: #6d7ab7;
  }

  label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
  }

  input {
    width: 100%;
    padding: 8px;
    margin-bottom: 16px;
    box-sizing: border-box;
  }

  button {
    background-color: #4caf50;
    color: #fff;
    padding: 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  button:hover {
    background-color: #45a049;
  }

  .confirmation {
    color: white;
  }
  .confirmation-message {
      background-color: #4CAF50; /* Green background */
      color: #fff; /* White text */
      padding: 10px;
      border-radius: 4px;
      margin-top: 1px;
      text-align: center;
      
    }
</style>

<Layout title='Request Product'>
  {messageSent && 
    <div class="confirmation-message">
      <p class="confirmation">Message has been sent!</p>
    </div>
  }
  
  <div class="container">
    <h2 style="text-align: center;">Requests</h2>
    <form method="POST">
      <!-- Add a hidden input field to specify the action -->
      <input type="hidden" name="action" value="requestFormSubmit">
      
      <label for="message">Message:</label>
      <textarea id="message" name="message" style="width: 100%; height: 100px; resize: none;" rows="4" cols="50" required ></textarea>

      <button type="submit">Submit</button>
    </form>
  </div>
</Layout>